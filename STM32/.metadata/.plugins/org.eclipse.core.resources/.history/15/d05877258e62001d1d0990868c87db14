/*
 * button.c
 *
 *  Created on: Nov 12, 2022
 *      Author: ASUS
 */

#include "button.h"

int button_pressed_flag = 0;

int KeyReg0[3] = {NORMAL_STATE, NORMAL_STATE, NORMAL_STATE};
int KeyReg1[3] = {NORMAL_STATE, NORMAL_STATE, NORMAL_STATE};
int KeyReg2[3] = {NORMAL_STATE, NORMAL_STATE, NORMAL_STATE};

int KeyReg3[3] = {NORMAL_STATE, NORMAL_STATE, NORMAL_STATE};

int TimerForKeyPress = 300;



//This func do work
void subKeyProcess(int sw) {
	HAL_GPIO_TogglePin(LED_TEST_GPIO_Port, LED_TEST_Pin);
	if (button_pressed_flag == 1) {
		button_pressed_flag = 0;
	}
}

void holdKeyProcess(int sw) {
	HAL_GPIO_TogglePin(LED_2_GPIO_Port, LED_2_Pin);
	if (button_pressed_flag == 1) {
		button_pressed_flag = 0;
	}
}

void getKeyInput(){
	for (int i = 0; i < 3; i++) {
		KeyReg0[i] = KeyReg1[i];
		KeyReg1[i] = KeyReg2[i];

		if (i == 0) {
			KeyReg2[i] = HAL_GPIO_ReadPin(, GPIO_Pin)
		}

		if ((KeyReg0[i] == KeyReg1[i]) && (KeyReg1[i] == KeyReg2[i])) {
			if (KeyReg3[i] != KeyReg2[i]) {
				KeyReg3[i] = KeyReg2[i];
				if (KeyReg2[i] == PRESSED_STATE) {
				  //TODO
				  subKeyProcess(i);
				  stop_hold = i;
				  //TimerForKeyPress = 300;
				}
				//9s delay, or is it?

				//300 doesn't yeild the result of 3s delay on my machine. However 900 does.
				TimerForKeyPress = 300;
			}
			else {
				TimerForKeyPress--;
				if (TimerForKeyPress == 0) {
					if (KeyReg2[i] == PRESSED_STATE) {
						  //TODO
						holdKeyProcess(stop_hold);
					}
					TimerForKeyPress = 100;
				}
			}
		}
	}
}

